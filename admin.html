<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LandKart Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mx-auto p-6 max-w-xl bg-white rounded shadow">
    <h1 class="text-2xl font-bold text-green-700 mb-4">Admin Panel - Add Land Listing</h1>

    <form id="addListingForm">
      <input type="hidden" id="editRow" />

      <label class="block font-semibold mt-4">Title</label>
      <input id="title" name="title" type="text" required class="border p-2 w-full"/>

      <label class="block font-semibold mt-4">Description</label>
      <textarea id="description" name="description" required class="border p-2 w-full"></textarea>

      <label class="block font-semibold mt-4">Price (â‚¹)</label>
      <input id="price" name="price" type="number" required class="border p-2 w-full"/>

      <label class="block font-semibold mt-4">Upload Image</label>
      <input id="image" name="image" type="file" accept="image/*" class="border p-2 w-full"/>

      <label class="block font-semibold mt-4">YouTube Link</label>
      <input id="youtube" name="youtube" type="url" placeholder="https://youtube.com/..." class="border p-2 w-full"/>

      <button type="submit" id="submitBtn" class="bg-green-600 text-white mt-4 px-4 py-2 rounded">Add Listing</button>
    </form>

    <div id="statusMessage" class="mt-4 text-sm text-green-700 font-semibold"></div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzcje6QXduHvEdQ5KT5HZqnJr7l_TDbKTPGi3lCQKC2qFSCUCLT0OQ3e4qOwh4sf3jLWQ/exec';

    const form = document.getElementById('addListingForm');
    const statusMessage = document.getElementById('statusMessage');
    const submitBtn = document.getElementById('submitBtn');
    const editRow = document.getElementById('editRow');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      statusMessage.textContent = 'Uploading...';

      const formData = new FormData();
      formData.append('title', form.title.value.trim());
      formData.append('description', form.description.value.trim());
      formData.append('price', form.price.value.trim());
      formData.append('youtube', form.youtube.value.trim());
      if (editRow.value) formData.append('editRow', editRow.value);

      const file = form.image.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = async function () {
          formData.append('image', reader.result);
          await sendData(formData);
        };
        reader.readAsDataURL(file);
      } else {
        formData.append('image', 'NO_IMAGE_UPDATE');
        await sendData(formData);
      }
    });

    async function sendData(formData) {
      try {
        const res = await fetch(API_URL, { method: 'POST', body: formData });
        const result = await res.json();
        if (result.status === 'success') {
          statusMessage.textContent = 'Listing added successfully!';
          form.reset();
        } else {
          statusMessage.textContent = 'Failed: ' + result.message;
        }
      } catch (err) {
        statusMessage.textContent = 'Error: ' + err.message;
      }
      submitBtn.disabled = false;
    }
  </script>
</body>
</html>
